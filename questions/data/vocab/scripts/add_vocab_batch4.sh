#!/usr/bin/env bash
set -euo pipefail

# --- 出力先（絶対パスで指定） ---
OUT_DIR="/Users/kentaroyoshizumi/Desktop/RissDojo/questions/data/vocab"
mkdir -p "$OUT_DIR"

# --- ファイルベース名（英名） ---
FILENAMES=(
  "social_engineering" "shoulder_hacking" "ransomware" "open_relay" "op25b"
  "bayesian_filter" "rlo" "double_extension" "spyware" "mail_bombing"
  "rootkit" "badnets" "adversarial_example" "prompt_injection" "worm"
  "trojan" "cc_malware" "downloader_malware" "polymorphic_virus" "darknet"
  "surface_web" "deep_web" "dark_web" "media_infection" "mail_infection" "macro_virus"
)

# --- 質問（日本語） ---
QUESTIONS=(
  "「ソーシャルエンジニアリング」とは何ですか？簡潔に説明してください。"
  "「ショルダーハッキング」とは何ですか？簡潔に説明してください。"
  "「ランサムウェア」とは何ですか？簡潔に説明してください。"
  "「第三者中継（オープンリレー）」とは何ですか？簡潔に説明してください。"
  "「OP25B（Outbound Port 25 Blocking）」とは何ですか？簡潔に説明してください。"
  "「ベイジアンフィルタリング」とは何ですか？簡潔に説明してください。"
  "「RLO（Right-to-Left Override）」とは何ですか？簡潔に説明してください。"
  "「二重拡張子」とは何ですか？簡潔に説明してください。"
  "「スパイウェア」とは何ですか？簡潔に説明してください。"
  "「メール爆撃」とは何ですか？簡潔に説明してください。"
  "「ルートキット」とは何ですか？簡潔に説明してください。"
  "「BadNets（バックドアが仕込まれたAIモデル）」とは何ですか？簡潔に説明してください。"
  "「敵対的サンプル攻撃」とは何ですか？簡潔に説明してください。"
  "「プロンプトインジェクション」とは何ですか？簡潔に説明してください。"
  "「ワーム（マルウェア）」とは何ですか？簡潔に説明してください。"
  "「トロイの木馬（マルウェア）」とは何ですか？簡潔に説明してください。"
  "「C&Cサーバ型（マルウェア）」とは何ですか？簡潔に説明してください。"
  "「ダウンロード型（マルウェア）」とは何ですか？簡潔に説明してください。"
  "「ポリモーフィック型ウィルス」とは何ですか？簡潔に説明してください。"
  "「ダークネット」とは何ですか？簡潔に説明してください。"
  "「サーフェスウェブ」とは何ですか？簡潔に説明してください。"
  "「ディープウェブ」とは何ですか？簡潔に説明してください。"
  "「ダークウェブ」とは何ですか？簡潔に説明してください。"
  "「媒体感染」とは何ですか？簡潔に説明してください。"
  "「メール感染」とは何ですか？簡潔に説明してください。"
  "「マクロウィルス」とは何ですか？簡潔に説明してください。"
)

# --- 模範解答（短め） ---
ANSWERS=(
  "人の心理や手続きを利用して情報や権限を不正に取得する手法（例：なりすまし、誘導）。"
  "他人の画面やキーボードを覗き見して認証情報等を盗む行為。"
  "ファイルを暗号化して復号の対価を要求するマルウェア。"
  "認証を求めずに外部のメールを中継できる状態で、スパム送信に悪用される設定不備。"
  "ISP等が送信ポート25の通信を遮断する措置で、ボット端末からの直接SMTP送信を防ぐ手法。"
  "単語の出現確率などを学習してスパムか否かを統計的に判定するフィルタリング技術。"
  "Unicode制御文字を悪用し表示順を入れ替えて拡張子等を偽装する手法。"
  "ファイル名に複数の拡張子を付け本来の実行形式を隠す偽装（例：document.pdf.exe）。"
  "利用者の情報を密かに収集・外部送信する不正ソフトの総称。"
  "短時間に大量のメールを送って受信者やシステムを妨害する行為。"
  "侵入後に痕跡隠蔽や持続化を行うためのツール群。"
  "学習データやモデルにバックドアを仕込み、特定トリガで誤動作させる手法/脆弱性。"
  "微小な摂動で機械学習モデルの誤判断を誘発する攻撃。"
  "LLM等への入力で指示を上書き・逸脱させ、意図しない出力を誘発する攻撃。"
  "自己増殖しネットワーク経由で広がるマルウェアの一種。"
  "正規のソフトに偽装して不正機能を実行するマルウェアの一種。"
  "外部の指令サーバ（C&C）と通信して命令を受けるマルウェアの構成。"
  "初期侵入後に外部から本体やペイロードをダウンロードして実行する型。"
  "自身のコードや署名を変化させ検知を回避するウィルス。"
  "観測や研究で使われる未割当IP等の監視可能領域（セキュリティ文脈）。"
  "検索エンジンにクロールされ索引化される公開Web領域。"
  "検索エンジンに索引化されないが正当なコンテンツを含むWeb領域（会員制等）。"
  "Tor等の匿名化技術上に構築され、秘匿されたサービス群を指す領域。"
  "USB等の媒体経由で感染・拡散する感染形態。"
  "メール添付やリンク経由で感染する感染形態。"
  "Office等のマクロ機能を悪用して拡散・実行されるウィルス。"
)

# --- 補足（簡潔） ---
EXPLANATIONS=(
  "教育と手続き、不要情報の遮断で対策。"
  "覗き見防止と入力時の注意が有効。"
  "バックアップと多層防御で被害を軽減。"
  "中継制御と認証強化で防止。"
  "端末からの直接SMTP送信を防ぐために実施される。"
  "定期学習と閾値調整、ホワイトリスト運用が必要。"
  "ファイルの表示実体を確認する運用が重要。"
  "拡張子表示や検疫で見分ける。"
  "振る舞い検知や許可制で対処。"
  "レート制限や送信元ブロックで緩和。"
  "整合性検査と再インストールが必要なことが多い。"
  "供給元検証とモデル検証が有効。"
  "入力検査やロバスト化が対策。"
  "入力分離と出力検証が重要。"
  "パッチ適用とネットワーク隔離で封じ込め。"
  "配布元確認とコード署名の確認が重要。"
  "通信遮断と振る舞い検知で封じ込め。"
  "実行制限と最小権限で被害を抑える。"
  "振る舞い検知やサンドボックスでの解析が有効。"
  "観測や異常検知に用いられる領域概念。"
  "一般の公開サイトが含まれる領域概念。"
  "認証やアクセス制御のある非索引領域が含まれる概念。"
  "匿名性で秘匿された領域の総称。"
  "持込媒体の管理と検査が対策。"
  "添付/リンクの検査とユーザ教育が重要。"
  "マクロ無効化と署名済みマクロの採用が対策。"
)

# --- ベースID決定（既存ファイルと衝突しない開始番号を自動で決める） ---
highest=$(find "$OUT_DIR" -maxdepth 1 -type f -name '*.json' -print | sed -E 's!.*/([0-9]+)_.*!\1!' | sort -n | tail -n1 || true)
if [ -z "$highest" ]; then
  BASE_ID=3000
else
  BASE_ID=$((highest + 1))
fi

# 生成
for i in "${!FILENAMES[@]}"; do
  id=$((BASE_ID + i))
  fname="${FILENAMES[i]}"
  q="${QUESTIONS[i]}"
  a="${ANSWERS[i]}"
  e="${EXPLANATIONS[i]}"

  out="$OUT_DIR/${id}_${fname}.json"

  cat > "$out" <<JSON
{
  "id": ${id},
  "question": "${q}",
  "answer": "${a}",
  "explanation": "${e}",
  "category": "vocab"
}
JSON

  echo "Wrote: $out"
done

echo "All done. Generated $(( ${#FILENAMES[@]} )) files under $OUT_DIR"
BASH
